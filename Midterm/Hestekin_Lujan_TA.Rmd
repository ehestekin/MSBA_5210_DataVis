---
title: "General Mills Cereal Sales Analysis"
author: "Eric Hestekin, Schyuler Lujan"
date: "2/13/2020"
output: 
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

Repo:  https://github.com/ehestekin/MSBA_5210_DataVis

``` {r echo = FALSE}
# Course: 5210 Communicating Data
# Purpose: General Mills Cereal Sales Analysis
# Date: 2/13/20
# Author: Eric Hestekin, Schyuler Lujan
# Repo:  https://github.com/ehestekin/MSBA_5210_DataVis
```

``` {r echo = FALSE, include = FALSE}
# Clear environment of variables and functions
rm(list = ls(all = TRUE)) 

# Clear environmet of packages
if(is.null(sessionInfo()$otherPkgs) == FALSE)lapply(paste("package:", names(sessionInfo()$otherPkgs), sep=""), detach, character.only = TRUE, unload = TRUE)

```

``` {r setup, include = FALSE, warning = FALSE}
# Load Library
library(tidyverse)
library(gridExtra) # Arranging charts
library(janitor)
library(knitr)
library(scales) # Modifying axis tick mark labels on charts
library(GGally) # Dumbbell and lollipop charts
library(stringr) # Cleanup on key columns
```

```{r}
# Turn off scientific notation
options(scipen = 999)
```

# Introduction to research

## Initial expectations / biases

- Not expecting significant seasonal trends, since cereal is a household staple
- Less expensive cereals sell more, more expensive cereals sell less
- More expensive cereals will sell more with promotions relative to without promotions

# Load data and get initial summary

```{r message = FALSE, warning = FALSE}
# Load sales data
sales_df <- read.csv("mtp_sales_data.csv")

# Load product data
product_df <- read.csv("mtp_product_data.csv")
```

# Uni-variate non-graphical analysis
## Look at first 10 rows

```{r message = FALSE, warning = FALSE}
# Look at first 10 rows of sales_df
head(sales_df, 10)

# Look at first 10 rows of product_df
head(product_df, 10)
```

**sales_df**

- `UPC` formatting has periods rather than dashes, so many need cleanup before joining tables
- `iri_key` is the store identifier, so rename later to make it clear

**product_df**

- check if `UPC` variable in `product_df` is unique for that table before joining
- possibly pull text from `brand` variable to separate cereal from brand for cleaner groupings

## Look at structure

```{r message = FALSE, warning = FALSE}
# Look at structure of sales_df
str(sales_df)

# Look at structure of product_df
str(product_df)

# Count number of unique UPC on both data frames
n_distinct(sales_df$UPC)

n_distinct(product_df$UPC)
```

## Data Transformations

```{r}
# Check if UPC in product_df is unique
sum(duplicated(product_df$UPC))

# Key cleanup in sales_df: replace periods with dashes
sales_df$UPC <- str_replace_all(sales_df$UPC, "[.]", "-")

# Key cleanup in product_df: remove first three characters
product_df$UPC <- sub("00-", "", product_df$UPC)

# Left join with sales_df as left table to preserve all sales data
full_df <- left_join(sales_df, product_df, by = c("UPC", "UPC"))

# Check for any null values in joined df
sum(is.na(full_df)) # no null values

# Rename iri_key variable for clarity
full_df <- rename(full_df, "store_key" = iri_key)

# Create new variables; 
full_df <- mutate(full_df, 
                  company = as.factor(
                    ifelse(str_detect(full_df$brand, "KELLOGGS"), "Kellogg",
                           ifelse(str_detect(full_df$brand, "GENERAL MILLS"), "General Mills", "Post"))),
                  total_sales = (units * price),
                  season = (week %/% 14) + 1,
                  ad2 = ifelse(full_df$ad == "NONE", 0, 1))

#Note above is integer division where 14 is number of weeks per season plus 1 so that week 13 is put in the first season (similar with week 52)
# The + 1 after the integer division is so seasons go 1 - 4 instead of 0 - 3

```

## Descriptive Statistics

```{r}
# View descriptive statistics to assess factor variables
summary(full_df)
```

**Initial Observations**

*store_key*

- there are a large number of stores, so grouping by stores may not yield useful results

*units*

- mean slightly higher than the mean with outliers, so skewed to the right
- what are the total units sold by brand? 

*price*

- roughly symmetric distribution
- majority of items (75%) are $`r quantile(full_df$price, c(0.75), type = 1)` or less, regardless of brand
- max price of $`r round(max(full_df$price),2)` indicates an outlier
- Maybe useful to look at price/volume for a consistent comparable?
-- Seems to be a wide variety of package sizes which leads to more variety in price/package

*promo*

- majority of sold items (`r (1 - round(mean(full_df$promo),2))*100`%) do not have in-store promotions, so must be mindful of sample sizes

*ad*

- majority of sold items (`r round(sum(full_df$ad == "NONE") / dim(full_df)[1] * 100,2)`%) don't have ads

*volume*

- mean and median are about the same; use either as measure of central tendency
- majority of items (75%) are `r quantile(full_df$volume, c(0.75), type = 1)` or less

*flavor*

- regular and toasted are the top two flavors

*package*

- `r round(sum(full_df$package == "BOX") / dim(full_df)[1] * 100,2)`% of observations come in a box

# Uni-variate graphical analysis
## Quantitative Variables

### Price

```{r}
# Price
grid.arrange(
  ggplot(data = full_df, mapping = aes(x = 1, y = price)) +
    geom_boxplot() +
    coord_flip(),
  
  ggplot(data = full_df, mapping = aes(x = price)) +
    geom_histogram(bins = 50),
  
  ncol = 1
)
```

### Price / Volume
``` {r}
#Compare above to price/volume
# NOTE/TODO: Not positive volume column is consistent unit.  Verify
grid.arrange(
  ggplot(data = full_df, mapping = aes(x = 1, y = price/volume)) +
    geom_boxplot() +
    coord_flip(),
  
  ggplot(full_df, mapping = aes(x = price/volume)) +
    geom_histogram(bins = 50),
  
  ncol = 1
)

```

Maybe more symmetrical main distribution, but maybe more outliers.
- Due to inconsitent unit of volume?

### Units

```{r}
# Units
grid.arrange(
  ggplot(data = full_df, mapping = aes(x = 1, y = units)) +
    geom_boxplot() +
    coord_flip(),
  
  ggplot(data = full_df, mapping = aes(x = units)) +
    geom_histogram(bins = 50),
  
  ncol = 1
)
```

Certainly not symmetrical.  Makes sense as it implies it's most common to sell fewer units in a week. 

### Volume

```{r}
# volume
grid.arrange(
  ggplot(data = full_df, mapping = aes(x = 1, y = volume)) +
    geom_boxplot() +
    coord_flip(),
  
  ggplot(data = full_df, mapping = aes(x = volume)) +
    geom_histogram(bins = 50),
  
  ncol = 1
)
```

### Total Sales
```{r}
grid.arrange(
ggplot(data = full_df, mapping = aes(x = 1, y = total_sales)) +
  geom_boxplot() +
  coord_flip(),
  
ggplot(data = full_df, mapping = aes(x = total_sales)) +
  geom_histogram(bins = 50),

nrow = 2)
```

## Categorical Variables

### Brand

```{r}
# Count by brand
full_df %>% 
  group_by(brand) %>% 
  summarize(n_brand = n()) %>% 
  ggplot(mapping = aes(x = reorder(brand, n_brand), y = n_brand)) +
  geom_bar(stat = 'identity') +
  xlab('Brand') +
  ylab('Count') +
  coord_flip()
```

### Flavor

```{r}
# Count by flavor
ggplot(data = full_df, mapping = aes(x = flavor)) +
  geom_bar()
#alternatively
#ggplot(data = full_df, mapping = aes(x = flavor)) + 
#   geom_histogram(stat = 'count')

```

### Company

```{r}
# Count by company
ggplot(data = full_df, mapping = aes(x = company)) +
  geom_bar()
```

### Ads

```{r}
ggplot(data = full_df, mapping = aes(x = ad)) +
  geom_bar()
  
```

- graph matches the descriptive statistics; majority of observations do not have ads
- Ad type "A" is slightly more than type "B"

# Multi-variate non-graphical analysis

## Categorical Variables

### Promos by brand

Check sample sizes within each brand. Look at proportion of promo observations within each brand and compare across brands. Do some brands have a higher proportion of promos than others?

```{r}
# Counts of promotional v. non-promotional observations
full_df %>% 
  tabyl(brand, promo) %>% 
  adorn_totals(where = c("row", "col"))

# Proportions of promotional v. non-promotional within brands
full_df %>% 
  tabyl(brand, promo) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_rounding(digits = 2)
```

- counts and sample sizes look fine for each brand, but watch counts for any addt'l cross-tabs
- proportion of promos pretty similar across brands, but with some clusters of high and low values

- brands with highest proportion of promos (>=0.25):
  - cocoa puffs, cocoa krispies, smart start, special k


- brands with lowest proportion of promos (<=0.20):
  - cheerios, cinnamon toast, kix, lucky charms, raisin bran

- what do these groupings have in common?

### Ad type by brand

```{r}
# Counts of observations for ad types A, B, and NONE by brand
full_df %>% 
  tabyl(brand, ad) %>% 
  adorn_totals(where = c("row", "col"))

# Use for graphing?
# full_df %>% 
#   group_by(brand, ad) %>% 
#   summarise(n = n()) %>% 
#   pivot_wider(names_from = ad, values_from = n)
```

- sample sizes are a bit lower for ad types A and B but still >30
- for each brand, the majority have no ads; what are the differences between ad types A and B?

```{r}
# Proportions for ad types A, B, excluding NONE to better compare between ads
full_df %>% 
  filter(ad != "NONE") %>% 
  tabyl(brand, ad) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_rounding(digits = 2)
```

- roughly a 60/40 split between ad types A and B, with most brands favoring ad type A
- exception is Post Grape Nuts, which favors ad type B
- does ad A yield better sales across brands?

### Flavor by company

```{r}
# Counts of observations by company and flavor
full_df %>% 
  tabyl(flavor, company) %>% 
  adorn_totals(where = c("row", "col"))

# Proportions as percentage of flavor total
full_df %>% 
  tabyl(flavor, company) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_rounding(digits = 2)

# Use for graphing?
# full_df %>% 
#   group_by(company, flavor) %>% 
#   summarise(n = n()) %>% 
#   pivot_wider(names_from = company, values_from = n)
```

- General Mills is the only company with cinnamon toast flavor
- For Regular flavor (the most popular flavor) General Mills has the lowest count of the 3 brands
- General Mills competes directly with Kellogg only on cocoa and toasted flavors

### Sales by company and brand

```{r}
# Sales volume and dollar amount by company
full_df %>%
  group_by(company) %>%
  summarise(units_sold = sum(units),
            p_units = sum(promo * units),
            percent_p_units = (round(p_units/units_sold,4)*100),
            total_sales = sum(total_sales),
            p_sales = sum(promo * units * price),
            percent_p_sales = round(p_sales/total_sales, 4)*100) %>%
  arrange(desc(percent_p_units))

# Sales volume and dollar amount by brand -- graph with fill = company to differentiate brands?
full_df %>% 
  group_by(brand) %>% 
  summarise(total_sales = sum(total_sales),
            p_sales = sum(promo * units * price), # sales that had promos
            percent_p_sales = round(p_sales/total_sales, 4)*100) %>% 
  arrange(desc(total_sales))
```

- General Mills has the lowest percentage of promotional sales (both in units sold and total sales), but second highest in total dollar amount
- Total sales appears to be positively correlated with total units sold; more units sold always yields higher sales
- Some brands have a higher proportion of sales from promotions; generally, ones with the highest proportion of promotional sales have lowest total sales, with Kix as the exception

### Sales across time period, overall and by brand or company

```{r}

grid.arrange(
full_df %>% 
  group_by(brand, company) %>% 
  summarize(avg_wkly_sales = mean(total_sales),
            all_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, avg_wkly_sales)
                       , y = avg_wkly_sales, fill = company)) +
  geom_bar(stat = 'identity') +
  coord_flip(),

full_df %>% 
  group_by(brand, company) %>% 
  summarize(avg_wkly_sales = mean(total_sales),
            all_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, avg_wkly_sales), y = all_sales, fill = company))+
  geom_bar(stat = 'identity')+
  coord_flip(),

ncol = 1)
```

Interesting the difference between the order between average weekly sales and total yearly sales.  Are more stores selling ceratin brands like frosted flakes?

- Did sanity check on this group_by.  Cheerios total sales is equal to avg_weekly * count (seen above in brand section) so method checks out.
-- Maybe there are more versions (UPCs) of some brands?

#### Check how many versions of each brand
```{r}
full_df %>% 
  group_by(brand) %>% 
  summarize(n = n_distinct(UPC)) %>% 
  arrange(desc(n))
```

Above table confirms suspision.  There are more unique versions (UPCs) of some cereals such as Froot Loops and Frosted Flakes.

### Sales by season

```{r}
# Total sales by company and season
full_df %>% 
  group_by(company, season) %>% 
  summarise(sales = sum(total_sales)) %>% 
  pivot_wider(names_from = season, values_from = sales)

# Total sales by brand and season
full_df %>% 
  group_by(brand, season) %>% 
  summarise(sales = sum(total_sales)) %>% 
  pivot_wider(names_from = season, values_from = sales)

# Total sales by flavor and season
full_df %>% 
  group_by(flavor, season) %>% 
  summarise(sales = sum(total_sales)) %>% 
  pivot_wider(names_from = season, values_from = sales)
```

- sales seem to drop slightly in season 4

### Sales by flavor

``` {r}
full_df %>% 
  group_by(flavor) %>% 
  summarize(sales_flav = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = flavor, y = sales_flav)) +
    geom_bar(stat = 'identity')
  
```

- what do sales look like by company? Although Kellogg's sales are highest overall, are there any differences by flavor?

## Quantitative Variables

Correlation table of quantitative variables
```{r}
full_df %>% 
  select_if(is.numeric) %>% 
  cor() %>% 
  round(2)
```

- moderately strong correlations:

  - negative association between price and promo; correlation = `r round(cor(full_df$price, full_df$promo),2)`
  - positive association between price and volume; correlation = `r round(cor(full_df$price, full_df$volume),2)`

- weak correlations:

  - positive associaton between promo and units: correlation = `r round(cor(full_df$promo, full_df$units),2)`

# Multi-variate graphical analysis

``` {r}
#interested in price/volume between promo and no promo for each company
grid.arrange(
  full_df[full_df$promo == 0,] %>% 
    ggplot(mapping = aes(x = volume * units, y = total_sales, color = company)) +
    geom_smooth() +
    scale_x_continuous('Total Volume', limits = c(0,80)) +
    scale_y_continuous('Total Sales', limits = c(0, 125)),
  
  full_df[full_df$promo == 1,] %>% 
    ggplot(mapping = aes(x = volume * units, y = total_sales, color = company)) +
    geom_smooth() +
    scale_x_continuous('Total Volume',limits = c(0,80)) +
    scale_y_continuous('Total Sales', limits = c(0, 125)),
  
  ncol = 1
)
  
  
```

GM is getting beat on Price/Volume in both promo and non-promo sales

## Categorical Variables

### Sales across companies by promos and ads

```{r}
# Comparing sales across companies
full_df %>% 
  group_by(company) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(company, sales), y = sales)) +
  geom_col() +
  coord_flip() +
  labs(title = "Total sales by company")

# Sales comparison with and without promos
full_df %>% 
  group_by(company, promo) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(company, sales), y = sales, group = promo)) +
  geom_col() +
  coord_flip() +
  facet_grid(. ~ promo)

# Sales comparison with and without ads
# Excluding those without ads to more easily compare ad categories A and B
full_df %>% 
  group_by(company, ad) %>% 
  filter(ad != "NONE") %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(company, sales), y = sales, group = ad)) +
  geom_col() +
  geom_text(aes(label = sales)) +
  coord_flip() +
  facet_grid(. ~ ad)

# Sales comparison only for products without ads
full_df %>% 
  group_by(company, ad) %>% 
  filter(ad == "NONE") %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(company, sales), y = sales)) +
  geom_col() +
  coord_flip() +
  geom_text(aes(label = sales)) +
  labs(title = "Sales by company, no ads",
       y = "Company")

# Sales by company and flavor
full_df %>% 
  group_by(company, flavor) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = flavor, y = sales, group = company, fill = company)) +
  geom_col(position = "dodge")

```

- When looking at total sales, sales with/without promos and with/without ads, Kellogg always has the highest, followed by General Mills and then Post. Assess for any changes to this pattern when looking at sales by brand.
- When there are ads, type "A" yields higher sales for Kellogg and General Mills while ad type "B" yields higher sales for Post.
- General Mills has higher sales in cocoa and toasted flavors and does not appear competitive in regular flavor

  - Why does it do better in these flavors relative to the competition? Are the price points better for these flavors? Are there any differences across ads / brands / promos?

### Sales across brands by promotions and ads

```{r}
# Comparing total sales across brands
full_df %>% 
  group_by(brand, company) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  coord_flip() +
  labs(title = "Total sales by brand")

# Sales comparison with and without promos
grid.arrange(
full_df %>% 
  group_by(brand, company, promo) %>% 
  filter(promo == 0) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  labs(title = "Sales by brand, without promos") +
  coord_flip(),

full_df %>% 
  group_by(brand, company, promo) %>% 
  filter(promo == 1) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  labs(title = "Sales by brand, with promos") +
  coord_flip(),

nrow = 2)

# Sales comparison across ad types
# Excluding those without ads to more easily compare ad categories A and B
grid.arrange(
full_df %>% 
  group_by(brand, company, ad) %>% 
  filter(ad == "A") %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  labs(title = "Sales by brand, ad type A",
       x = "Brand") +
  coord_flip(),

full_df %>% 
  group_by(brand, company, ad) %>% 
  filter(ad == "B") %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  labs(title = "Sales by brand, ad type B",
       x = "Brand") +
  coord_flip(),

ncol = 1)

# Sales comparison only for products without ads
full_df %>% 
  group_by(brand, company, ad) %>% 
  filter(ad == "NONE") %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = reorder(brand, sales), y = sales, fill = company)) +
  geom_col() +
  labs(title = "Sales by brand, no ad") +
  coord_flip()

```

Total Sales

- For total sales, three General Mills brands are in the top 5 and two are in the bottom 5
- Does this same pattern hold across promos and ads?

Promotions

- Without promos, General Mills sales are higher relative to other brands
- With promos, General Mills sales are lower relative to other brands
- Why does GM do better with total sales relative to other brands without promos?

Ads

- General Mills brands do worse relative to other brands with ad type "B"
- Also do better relative to other brands when there are no ads

### Sales by Season

```{r}
# What is the proportion of sales attributed to each season within brand?
full_df %>% 
  group_by(brand, season) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = brand, y = sales, fill = season)) +
  geom_col(position = "fill") +
  coord_flip()

```

<<<<<<< HEAD
- each brand's sales are fairly evenly distributed across season; no notable differences apparent by brand

```{r}
# Line graph showing total sales by company for the year
full_df %>% 
  group_by(company, week) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = week, y = sales, group = company, color = company)) +
  geom_line() +
  theme_bw()

# Line graphs showing total sales by company with promos vs without promos
full_df %>% 
  group_by(company, week, promo) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = week, y = sales, group = company, color = company)) + 
  geom_line() +
  facet_grid(promo ~ .) +
  theme_bw()
```

- weekly sales follows the same pattern of Kellogg consistently having the highest sales; gap is closed a bit when we look at promos v no promos
- This shows overall performance, but are there any differences when we look at brands or flavors?

```{r}
# Look at Cocoa and Toasted flavors only
grid.arrange(
full_df %>% 
  filter(flavor == "COCOA") %>% 
  group_by(company, brand, week, flavor) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = week, y = sales, group = brand, color = company)) + 
  geom_line() +
  labs(title = "Weekly sales for Cocoa Flavor") +
  theme_bw(),

full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, brand, week, flavor) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = week, y = sales, group = brand, color = company)) + 
  geom_line() +
  labs(title = "Weekly sales for Toasted Flavor") +
  theme_bw(),

ncol = 1)
```

- for cocoa flavor, General Mills had higher sales until about halfway through the year; what happened?
- toasted flavor weekly sales also generally look higher for GM brands
=======
### Promos and Ads by Season for each company

```{r}
#Do some companies run more promotions at certain times of year?
#Number of sales each season
# full_df %>% 
#   ggplot(mapping = aes(x = season, fill = company)) +
#   geom_bar(position = 'dodge')

grid.arrange(
full_df %>% 
  group_by(company,season) %>% 
  summarize(n = n()) %>% 
  ggplot(mapping = aes(x = season, y = n, color = company)) +
  geom_line(),

full_df %>% 
  group_by(company, season) %>% 
  summarize(n = n(), perc_promo = sum(promo)/n) %>% 
  ggplot(mapping = aes(x = season, y = perc_promo, fill = company)) +
  geom_bar(position = 'dodge', stat = 'identity'),

ncol = 1
)
```
>>>>>>> f5ba9766163b7d916e6d7e7f802b74b78178b92a

## Quantitative Variables

## Categorical and Quantitative Variables

# Detailed exploratory analysis

General Mills leads total sales for toasted flavor and cocoa flavor. Examine potential differences by promos / ads / time period to identify areas where General Mills might be doing better or worse than the competition. Specific question:

- With flavor categories, do ads and promotions help or hurt General Mills sales?

### Sales across brands and promos

```{r}
# Total sales across seasons for promos vs. no promos across flavors
full_df %>% 
  filter(flavor != "CINNAMON TOAST",
         flavor != "FRUIT") %>% 
  group_by(company, brand, season, promo, flavor) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = season, y = sales, group = company, fill = company)) + 
  geom_col(position = "dodge") +
  theme_bw() +
  labs(title = "Total sales by company across flavors and promos") +
  facet_grid(promo ~ flavor)
```

- We see that Kellogg picked up its Cocoa sales partway through the year
- For toasted flavor, promos seem to hurt GM's competitiveness relative to Kellogg
- For regular flavor, Kellogg is still highest overall with and without promos

### Sales across brands and ads

- For toasted flavor, GM is negatively impacted relative to competition with ads (either A or B)

```{r}
# Total Sales, ads v no ads
full_df %>% 
  #filter() %>% 
  group_by(company, brand, season, ad2, flavor) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = season, y = sales, group = company, fill = company)) + 
  geom_col(position = "dodge") +
  theme_bw() +
  labs(title = "Total sales across flavors, ads v no ads") +
  facet_grid(ad2 ~ flavor)
```

- In regular regular, Kellogg maintains its lead ahead of other brands with and without promotions
- In toasted flavor, General Mills loses its lead and appears to perform worse relative to Kellogg

**Closer look at toasted flavor**

```{r}
# Total sales across seasons for promos vs. no promos for toasted flavor only, to compare against units sold
full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, brand, season, promo) %>% 
  summarise(sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = season, y = sales, group = brand, fill = brand)) + 
  geom_col(position = "dodge") +
  theme_bw() +
  labs(title = "Total sales by brand for toasted flavor, promos vs no promos") +
  facet_grid(promo ~ .)
```

- Without promos, Cheerios units sold and total sales is the highest of all brands
- With promos, Cheerios sales volume is about even with other brands, at times lower
- Promos appear to have a negative impact to the competitiveness of Cheerios relative to other toasted brands
  - With promos, are the price points too similar between Cheerios and other brands?
 
# Statistical analysis

Overall, it looks like ads and promos have a negative impact on General Mills sales relative to the competition, even in the Toasted flavor category where General Mills leads overall in sales. Will focus on statistical testing on differences between companies for the toasted flavor category, assessing any major negative impacts of promotions and ads on General Mills sales.

## Promos vs. no promos

Assess differences in average weekly sales between General Mills and Kellogg when there are promotions and when there are no promotions.

### Check distributions of the samples

```{r}
# Check boxplots of these samples
full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, promo, week) %>% 
  summarise(wkly_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = company, y = wkly_sales)) +
  geom_boxplot() +
  labs(title = "Weekly sales for toasted flavor, with and without promos") +
  facet_grid(.~promo)
```

- Boxplots show that GM weekly sales are higher than Kellogg without promos and lower than Kellogg with promos

```{r}
# Check distributions of these samples
full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, promo, week) %>% 
  summarise(wkly_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(wkly_sales)) +
  geom_histogram(binwidth = 175) +
  facet_grid(promo ~ company) +
  labs(title = "Distribution of toasted weekly sales by company, across promos")
```

- Histograms without promos show that the distributions of both samples are normally distributed
  - Use means to test differences btwn. companies when there are no promos
- Histograms with promos show slightly right-skewed
  - Use medians to test differences btwn. companies when there are promos

```{r}
# Create new object to make hypothesis testing a bit easier, since I'm testing some very specific samples
toasted <- 
  full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, week, promo) %>% 
  summarise(sales = sum(total_sales)) %>% 
  pivot_wider(names_from = company, values_from = sales) %>% 
  rename("General_Mills" = "General Mills")  
  #mutate(difference = General_Mills - Kellogg)
```

### Test differences with promotions

- Sample 1: Weekly sales of General Mills Toasted flavor cereals with promotions
- Sample 2: Weekly sales of Kellogg Toasted flavor cereals with promotions

When there are promotions for toasted flavor cereals, is there a stastically significant and practically significant difference in average weekly sales between companies?

- Ho: GM avg. weekly sales - KG avg. weekly sales = 0
- Ha: GM avg. weekly sales - KG avg. weekly sales != 0


```{r}
# Testing the median
wilcox.test(toasted$General_Mills[toasted$promo == 1],
            toasted$Kellogg[toasted$promo == 1],
            conf.int = TRUE)
```

```{r}
# Two-tailed test for differences between the means
# t.test(toasted$General_Mills[toasted$promo == 1],
#        toasted$Kellogg[toasted$promo == 1],
#        conf.level = 0.95)
```

- We reject the null hypothesis
- For toasted flavors, median weekly sales are statistically different between General Mills and Kellogg
- On average, General Mills weekly sales are $196 less than Kellogg
- Confidence interval shows us that 95% of the time, General Mills will have lower sales than Kellogg

  - 95% of the time, General Mills median weekly toasted flavor sales will be between $268.48 and $113.57 less than Kellogg

**Conclusion:** There is statistical evidence to support the claim that weekly sales of General Mills toasted flavor cereals are less than Kellogg cereals when there are promotions. Essentially, General Mills performs worse relative to the competition in toasted cereals when there are promotions.

### Test differences without promotions

- Sample 1: Weekly sales of General Mills Toasted flavor without promotions
- Sample 2: Weekly sales of Kellogg Toasted flavor without promotions

When there are no promotions for toasted flavor cereals, is there a stastically significant and practically significant difference in average weekly sales between companies?

- Ho: GM avg. weekly sales - KG avg. weekly sales = 0
- Ha: GM avg. weekly sales - KG avg. weekly sales != 0

```{r}
# Two-tailed test for differences about the means
t.test(toasted$General_Mills[toasted$promo == 0],
       toasted$Kellogg[toasted$promo == 0],
       conf.level = 0.95)
```

- We reject the null hypothesis
- For toasted flavors, avg. weekly sales are statistically different between General Mills and Kellogg
- On average, General Mills weekly sales are $382 higher than Kellogg in toasted cereal flavors w/out promotions
- Confidence interval shows us that 95% of the time, General Mills will have higher sales than Kellogg

  - 95% of the time, General Mills weekly sales will be between $233.76 and $530.31 higher than Kellogg
  
**Conclusion:** There is statistical evidence to support the claim that, on average, weekly sales for General Mills toasted cereals are higher than Kellogg toasted cereals without promotions. In plain language, General Mills performs better relative to the competition in toasted cereals when there are no promotions.

## Ads vs. no ads for toasted flavor cereals

We are combining ad types A and B to increase sample sizes and test the difference of ads v. no ads because we found during EDA that there wasn't a substantial difference between ad types A and B.

### Check distributions for the samples

First, check the boxplots and histograms for the two samples:

```{r}
# Check boxplots of these samples
full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, ad2, week) %>% 
  summarise(wkly_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(x = company, y = wkly_sales)) +
  geom_boxplot() +
  labs(title = "Weekly sales for toasted flavor, with and without ads") +
  facet_grid(.~ad2)

# Check distributions of these samples
full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, ad2, week) %>% 
  summarise(wkly_sales = sum(total_sales)) %>% 
  ggplot(mapping = aes(wkly_sales)) +
  geom_histogram(binwidth = 175) +
  facet_grid(ad2 ~ company) +
  labs(title = "Distribution of toasted weekly sales by company, ads v no ads")
```

- Boxplot shows there is a difference between ads and no ads;
  - GM performs better relative to KG without ads, but worse with ads
- Normal distribution without ads, right-skewed with ads
  - Test median when testing with ads

### With ads

```{r}
# Create new object to make hypothesis testing a bit easier
toasted2 <- 
  full_df %>% 
  filter(flavor == "TOASTED") %>% 
  group_by(company, week, ad2) %>% 
  summarise(sales = sum(total_sales)) %>% 
  pivot_wider(names_from = company, values_from = sales) %>% 
  rename("General_Mills" = "General Mills")
```


- Sample 1: Weekly sales of General Mills Toasted flavor cereals with ads
- Sample 2: Weekly sales of Kellogg Toasted flavor cereals with ads

When there are ads for toasted flavor cereals, is there a stastically significant and practically significant difference in average weekly sales between companies?

Ho: GM median weekly sales - KG median weekly sales = 0

Ha: GM median weekly sales - KG median weekly sales != 0

```{r}
# Test the medians
wilcox.test(toasted2$General_Mills[toasted2$ad2 == 1],
            toasted2$Kellogg[toasted2$ad2 == 1],
            conf.int = TRUE)
```

- reject the null hypothesis

### Without ads

```{r}
# Two-tailed test for differences about the means
t.test(toasted2$General_Mills[toasted$promo == 0],
       toasted2$Kellogg[toasted$promo == 0],
       conf.level = 0.95)
```

- reject the null hypothesis

# Regression analysis

# Conclusions and final visualizations





